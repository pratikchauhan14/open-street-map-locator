<!DOCTYPE html>
<html>

<head>
    <title>OpenStreetMap with Leaflet</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="style.css">
    <style type="text/tailwindcss">
        .leaflet-popup-content-wrapper, .leaflet-popup-tip {
            @apply bg-white text-black dark:bg-gray-800 dark:text-white;
        }

        .listing-item.active {
            @apply bg-blue-100 dark:bg-blue-950 dark:text-blue-200;
            border-left: 4px solid #4f46e5; /* A solid colored left border */
        }
        .leaflet-popup-content {  line-height: 1.3; font-size: 13px; font-size: 1.08333em; min-height: 1px; }
        .leaflet-popup-content-wrapper { @apply rounded-lg overflow-hidden text-left ; }

        .map-section{ @apply flex flex-col md:flex-row; }
        .sidebar{
            @apply w-full hidden md:block md:w-[400px] md:h-[calc(100vh-135px)] md:overflow-y-scroll;
        }
        .map-container{
            @apply w-full h-[calc(100vh-203px)] md:w-[calc(100%-400px)] md:h-[calc(100vh-135px)] md:overflow-y-scroll;
        }

        .single-filter{
            @apply flex items-center gap-2 md:border md:border-gray-200 md:dark:border-gray-700 md:p-2 md:rounded-md;
        }
        .filter-group-wrapper{
            @apply p-2 md:p-0 flex flex-wrap gap-2 md:gap-4;
        }

        select{
            @apply dark:bg-gray-800 dark:text-white text-xs font-medium rounded-md border border-gray-300 dark:border-gray-700 hover:bg-gray-700 hover:text-white dark:hover:bg-gray-700 dark:hover:text-white hover:border-gray-300 dark:hover:border-gray-700 transition-colors font-bold;
        }
        label{
            @apply text-xs font-bold text-gray-600 dark:text-gray-300 whitespace-nowrap;
        }

        a.leaflet-popup-close-button {
    background: #fff !important;
    height: 48px !important;
    width: 48px !important;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 0 0 0 50%;
}

a.leaflet-popup-close-button span {font-size: 23px;}

        /* media query md */
        @media screen and (min-width: 768px) {
            .filter-group-wrapper{
                @apply p-4 border-b border-gray-200 dark:border-gray-700 dark:bg-gray-950 dark:text-white flex items-center gap-4 bg-white
            }
        }


    </style>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="data.js"></script>
    <script src="index.js"></script>

</head>

<body>
    <div
        class="px-2 py-2 md:p-4 border-b border-gray-200 dark:border-gray-700 dark:bg-gray-950 dark:text-white flex items-center justify-between bg-white">
        <div class="flex items-center gap-4">
            <h1 class="text-xs md:text-2xl font-bold">
                <a class="text-blue-600 hover:text-blue-800 dark:text-white dark:hover:text-white" href="/">OpenStreet</a>
                /
                <a class="text-blue-600 hover:text-blue-800 dark:text-white dark:hover:text-white" href="/google.html">Google</a>
                Store Locator
            </h1>
        </div>

        <div class="flex items-center gap-4">
            <!-- Contact us -->
            <a href="mailto:pratik@2cube.studio"
                class="hidden md:block text-xs font-medium text-blue-600 hover:text-blue-800 dark:text-white dark:hover:text-white">Contact
                us</a>
            <!-- GitHub -->
            <a href="https://2cube.studio" target="_blank" class="
            px-4 py-2 dark:bg-gray-800 dark:text-white text-xs font-medium rounded-md border border-gray-300 dark:border-gray-700
            hover:bg-gray-700 hover:text-white dark:hover:bg-gray-700 dark:hover:text-white hover:border-gray-300 dark:hover:border-gray-700
            transition-colors font-bold
            ">2CUBE Studio</a>
        </div>
    </div>


    <div class="filter-group-wrapper">

        <!-- country wise filter -->
        <div class="single-filter">
            <label for="countryFilter" class="text-xs font-bold text-gray-600 dark:text-gray-300">Filter by
                Country:</label>
            <select id="countryFilter" data-filter="country">
                <option value="all">All</option>
                <option value="India">India</option>
                <option value="United States">United States</option>
                <option value="Australia">Australia</option>
                <option value="Canada">Canada</option>
                <option value="Germany">Germany</option>
            </select>
        </div>

        <!-- type wise filter radio buttons -->
        <div class="single-filter">
            <label for="typeFilter" class="text-xs font-bold text-gray-600 dark:text-gray-300">Filter by Type:</label>
            <input type="radio" id="typeFilterAll" name="typeFilter" value="all" checked>
            <label for="typeFilterAll" class="text-xs font-bold text-gray-600 dark:text-gray-300">All</label>
            <input type="radio" id="typeFilterPoint" name="typeFilter" value="point">
            <label for="typeFilterPoint" class="text-xs font-bold text-gray-600 dark:text-gray-300">Point</label>
            <input type="radio" id="typeFilterNew" name="typeFilter" value="new">
            <label for="typeFilterNew" class="text-xs font-bold text-gray-600 dark:text-gray-300">New</label>
        </div>


        <!-- Label wise filter -->
        <div class="single-filter">
            <label for="labelFilter" class="text-xs font-bold text-gray-600 dark:text-gray-300">Filter by Label:</label>
            <select id="labelFilter" data-filter="label">
                <option value="all">All</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
            </select>
        </div>

        <!-- label_color wise filter -->
        <div class="single-filter">
            <label for="labelColorFilter" class="text-xs font-bold text-gray-600 dark:text-gray-300">Filter by Label
                Color:</label>
            <select id="labelColorFilter" data-filter="label_color">
                <option value="all">All</option>
                <option value="red">Red</option>
                <option value="blue">Blue</option>
                <option value="green">Green</option>
            </select>
        </div>

        <!-- is_active checkbox -->
        <div class="single-filter">
            <label for="isActiveFilter" class="text-xs font-bold text-gray-600 dark:text-gray-300">Filter by Is
                Active:</label>
            <input type="checkbox" id="isActiveFilter" class="" data-filter="is_active">
        </div>

        <!-- reset of the filters -->
        <div class="w-full md:w-auto">
            <button id="resetFilters"
                class="px-4 py-2 dark:bg-gray-800 dark:text-white text-xs font-medium rounded-md border border-gray-300 dark:border-gray-700 hover:bg-gray-700 hover:text-white dark:hover:bg-gray-700 dark:hover:text-white hover:border-gray-300 dark:hover:border-gray-700 transition-colors font-bold"
                data-filter="reset">Reset Filters</button>
        </div>

    </div>

    <div class="map-section">
        <div class="sidebar">
            <div id="listing" class="w-full h-full"></div>
        </div>
        <div class="map-container ">
            <div id="map" class="w-full h-full"></div>
        </div>
    </div>



    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 1. Define your filter configurations ---
            const filterConfig = [
                { id: 'countryFilter', key: 'country', type: 'select' },
                { name: 'typeFilter', key: 'type', type: 'radio' },
                { id: 'labelFilter', key: 'label', type: 'select' },
                { id: 'labelColorFilter', key: 'label_color', type: 'select' },
                { id: 'isActiveFilter', key: 'is_active', type: 'checkbox' }
            ];

            // --- 2. Define a custom template for the sidebar listing ---
            const customListingTemplate = (location) => {
                // Determine status color and text for the "is_active" property
                const statusColor = location.is_active ? 'bg-green-500' : 'bg-gray-400';
                const statusText = location.is_active ? 'Active' : 'Inactive';

                return `
        <div class="listing-item flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer dark:bg-gray-800 dark:hover:bg-gray-950">
            
            <div class="flex-grow">
                <div class="flex items-center gap-2">
                    <div class="flex-shrink-0" title="${statusText}">
                        <div class="w-3 h-3 rounded-full ${statusColor}"></div>
                    </div>
                    <h4 class="font-bold text-base text-gray-900 dark:text-white">${location.name}</h4>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-300">${location.content}</p>
                <div class="mt-2 flex items-center gap-2">
                    <p class="px-2 py-0.5 text-xs font-semibold text-black rounded-full border border-gray-300 bg-gray-100">${location.country}</p>
                    <span class="px-2 py-0.5 text-xs font-semibold text-blue-800 bg-blue-100 rounded-full dark:bg-blue-900 dark:text-blue-200 capitalize">
                        ${location.type}
                    </span>
                    <span class="px-2 py-0.5 text-xs font-semibold text-white rounded-full" style="background-color: ${location.label_color};">
                        Label: ${location.label}
                    </span>
                </div>
            </div>
        </div>
    `;
            };

            // --- NEW: Define a custom template for the map popup (infobox) ---
            const customInfoboxTemplate = (location) => {
                const activeStatus = location.is_active ? 'Active' : 'Inactive';
                const statusColor = location.is_active ? 'bg-green-500' : 'bg-gray-400';
                const statusText = location.is_active ? 'Active' : 'Inactive';
                return `
        <div class="custom-infobox">
            <div class="w-full ">
                <img src="${location.imageUrl}" alt="${location.name}" class="w-full object-cover">
            </div>
            <div class="flex-grow p-3">
                <div class="flex items-center gap-2">
                    <div class="flex-shrink-0" title="${statusText}">
                        <div class="w-3 h-3 rounded-full ${statusColor}"></div>
                    </div>
                    <h4 class="font-bold text-base text-gray-900 dark:text-white">${location.name}</h4>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-300">${location.content}</p>
                <div class="mt-2 flex items-center gap-2">
                    <p class="px-2 py-0.5 text-xs font-semibold text-black rounded-full border border-gray-300 bg-gray-100">${location.country}</p>
                    <span class="px-2 py-0.5 text-xs font-semibold text-blue-800 bg-blue-100 rounded-full dark:bg-blue-900 dark:text-blue-200 capitalize">
                        ${location.type}
                    </span>
                    <span class="px-2 py-0.5 text-xs font-semibold text-white rounded-full" style="background-color: ${location.label_color};">
                        Label: ${location.label}
                    </span>
                </div>
                
            </div>
            
        </div>
    `;
            };

            // --- 3. Put it all together in the main options object ---
            const mapOptions = {
                mapId: 'map',
                listingId: 'listing',
                data: mapData,
                filters: filterConfig,
                listingTemplate: customListingTemplate,
                infoboxTemplate: customInfoboxTemplate, // <-- ADD THIS LINE
                initialCenter: [25, 20],
                initialZoom: 2
            };

            // --- 4. Create the map instance ---
            const myMap = new MapManager(mapOptions);

            // --- 5. Add Event Listener for the Reset Button ---
            const resetButton = document.getElementById('resetFilters');
            if (resetButton) {
                resetButton.addEventListener('click', () => myMap.reset());
            }
        });
    </script>

</body>

</html>